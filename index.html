<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BMO - Interfaz de Expresiones</title>
<style>
    /* Estética de la pantalla de BMO */
    * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
    body { 
        background-color: #66E0D4; 
        height: 100vh; 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        overflow: hidden; 
        transition: background-color 0.5s ease; 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .face-svg { width: 85vw; max-width: 500px; height: auto; }
    
    /* Líneas suaves para las expresiones */
    .stroke-line { 
        fill: none; 
        stroke: #1a1a1a; 
        stroke-width: 6; 
        stroke-linecap: round; 
        transition: d 0.2s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s; 
    }

    .eye-dot { fill: #1a1a1a; opacity: 0; transition: opacity 0.3s; }
    
    /* Animación de la boca al hablar */
    .mouth-open { 
        fill: #1a1a1a; 
        opacity: 0; 
        transform-origin: center; 
    }

    .talking .mouth-open { opacity: 1; animation: talk 0.15s infinite alternate; }
    .talking .mouth-closed { opacity: 0; }

    @keyframes talk { 
        from { transform: scaleY(0.6) translateY(5px); } 
        to { transform: scaleY(1.2) translateY(-5px); } 
    }

    /* Indicadores de estado */
    #status { 
        position: absolute; 
        top: 20px; 
        font-size: 14px; 
        color: rgba(0,0,0,0.4); 
        text-transform: uppercase; 
        letter-spacing: 2px;
    }
</style>
</head>
<body id="mainBody">

<div id="status">Esperando a BMO...</div>

<svg id="faceSvg" class="face-svg" viewBox="0 0 200 150">
    <path id="browL" class="stroke-line" d="M45,40 L65,55" style="opacity:0" />
    <path id="browR" class="stroke-line" d="M155,40 L135,55" style="opacity:0" />

    <path id="eyeL" class="stroke-line" d="M50,65 Q60,55 70,65" />
    <path id="eyeR" class="stroke-line" d="M130,65 Q140,55 150,65" />

    <circle id="dotL" class="eye-dot" cx="60" cy="70" r="7" />
    <circle id="dotR" class="eye-dot" cx="140" cy="70" r="7" />

    <path id="mouthClosed" class="stroke-line mouth-closed" d="M75,105 Q100,115 125,105" />
    <ellipse id="mouthOpen" class="mouth-open" cx="100" cy="110" rx="15" ry="12" />
</svg>

<script>
const body = document.getElementById("mainBody");
const statusDiv = document.getElementById("status");
const eyeL = document.getElementById("eyeL"), eyeR = document.getElementById("eyeR");
const dotL = document.getElementById("dotL"), dotR = document.getElementById("dotR");
const browL = document.getElementById("browL"), browR = document.getElementById("browR");
const mouthClosed = document.getElementById("mouthClosed");

let socket = null;

function connect() {
    socket = new WebSocket('ws://localhost:8765');
    
    socket.onopen = () => {
        statusDiv.innerText = "BMO Conectado";
        console.log("Conectado");
    };
    
    socket.onmessage = (event) => {
        const data = event.data;
        
        if (data.startsWith("DRAW:")) {
            const parts = data.replace("DRAW:", "").split("|");
            
            if (parts.length === 6) {
                const [dEyeL, dEyeR, dMouth, bgColor, useDots, useBrows] = parts;
                
                // Actualizar trazados (paths)
                eyeL.setAttribute('d', dEyeL);
                eyeR.setAttribute('d', dEyeR);
                mouthClosed.setAttribute('d', dMouth);
                
                // Color de fondo
                body.style.backgroundColor = bgColor;
                
                // Lógica de Puntos vs Líneas (para la expresión ASOMBRO)
                if (useDots === "1") {
                    dotL.style.opacity = "1";
                    dotR.style.opacity = "1";
                    eyeL.style.opacity = "0";
                    eyeR.style.opacity = "0";
                } else {
                    dotL.style.opacity = "0";
                    dotR.style.opacity = "0";
                    eyeL.style.opacity = "1";
                    eyeR.style.opacity = "1";
                }
                
                // Lógica de Cejas (para PENSANDO o ENOJADO)
                browL.style.opacity = useBrows === "1" ? "1" : "0";
                browR.style.opacity = useBrows === "1" ? "1" : "0";
            }
        }
        
        if (data === "START_TALKING") body.classList.add("talking");
        if (data === "STOP_TALKING") body.classList.remove("talking");
        if (data === "SHUTDOWN") statusDiv.innerText = "BMO APAGADO";
    };
    
    socket.onclose = () => {
        statusDiv.innerText = "Reconectando...";
        setTimeout(connect, 2000);
    };
}

connect();
</script>
</body>
</html>
